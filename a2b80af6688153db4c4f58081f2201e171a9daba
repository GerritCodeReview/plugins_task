{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b44dd534_1877aecf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2021-04-07T21:45:52Z",
      "side": 1,
      "message": "This builds successfully on gerrit 3.2.",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9112f37_a31d7500",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2021-04-07T21:44:34Z",
      "side": 1,
      "message": "Note that when we add support for gerrit 3.3, this needs to be made \"load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\".",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9b23c789_fc15847c",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-04-07T22:42:58Z",
      "side": 1,
      "message": "This doesn\u0027t seem to be exposed through bazlets (or however it should be exposed) and so it breaks the standalone build. Are there any UI plugins that support standalone builds still? (I see reviewers removed it [1])\n\n[1] https://gerrit.googlesource.com/plugins/reviewers/+/d642d9664770257a9eacd09d8e35c22eea4dacb3",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5091c56b_08b0056c",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1029953
      },
      "writtenOn": "2021-04-07T22:46:55Z",
      "side": 1,
      "message": "Going off that change, it doesn\u0027t seem like gerrit supports polymer 3 plugins in standalone mode.",
      "parentUuid": "9b23c789_fc15847c",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1affc388_5ad11a7b",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-04-07T22:51:14Z",
      "side": 1,
      "message": "That\u0027s a real bummer. @DavidO/Ben, any thoughts on how we can fix that?",
      "parentUuid": "5091c56b_08b0056c",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08f40f52_dfec41c7",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-04-07T22:57:11Z",
      "side": 1,
      "message": "Also, seems like https://gerrit-review.googlesource.com/Documentation/dev-build-plugins.html and other docs need update(s) for UI plugins.",
      "parentUuid": "1affc388_5ad11a7b",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8484ba58_a20195e0",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-04-08T08:38:30Z",
      "side": 1,
      "message": "\u003e That\u0027s a real bummer. @DavidO/Ben, any thoughts on how we can fix that?\n\nRemove standalone build mode. rules_nodejs support was never added to standalone build mode.",
      "parentUuid": "08f40f52_dfec41c7",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "488030e4_a9bd5813",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2021-04-08T10:11:09Z",
      "side": 1,
      "message": "I am not aware of any UI plugins that support standalone build mode.\n\nI am not the expert here (Dmitrii and David are), but my guess is that maintaining standalone build mode for UI plugins is a substantial amount of work, so we would need to understand the benefit of it.\n\nRe documentation: Yes, we are aware of that and I promise to update the docs substantially this quarter. Until that is done feel free to send me emails directly asking for help.",
      "parentUuid": "8484ba58_a20195e0",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b35467b0_5328feae",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2021-04-08T14:07:44Z",
      "side": 1,
      "message": "\u003e I am not aware of any UI plugins that support standalone build mode.\n\nThis was working in the task plugin and the reviewers plugin prior to Polymer 3.\n\n\u003e \n\u003e I am not the expert here (Dmitrii and David are), but my guess is that maintaining standalone build mode for UI plugins is a substantial amount of work, so we would need to understand the benefit of it.\n\nThe face value benefit is that I only need to clone the plugin I want to develop on to be able to develop it. I would think most non-core-plugin development happens against a stable Gerrit version, so having the Gerrit source tree shouldn\u0027t be required. That benefit multiplies into others like a simpler CI/CD setup too.\n\n\u003e \n\u003e Re documentation: Yes, we are aware of that and I promise to update the docs substantially this quarter. Until that is done feel free to send me emails directly asking for help.\n\nThanks!",
      "parentUuid": "488030e4_a9bd5813",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d0af775_81467798",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1013302
      },
      "writtenOn": "2021-04-12T07:42:04Z",
      "side": 1,
      "message": "Building a Gerrit frontend plugin means building a js file and putting it into the resources of the gerrit_plugin() rule. You can build this js file in any way you want. We are just providing and maintaining one canonical way of building the core frontend plugins, and that way does not support standalone build at the moment. I have no idea how hard it would be to add this support, but it would cost me a day or so to figure it out, so I cannot prioritize that, because I don\u0027t think it is the Gerrit frontend teams\u0027 responsibility to build this.\n\nBut I think there is another way to unblock you, if you cannot do without the standalone build for 3.4:\n\nThese three BUILD rules look a bit intimidating, but they don\u0027t actually do much:\n\n1. rollup_bundle: Roll up the 3 js files into 1 but resolving the module imports.\n2. polygerrit_plugin: Minify the js.\n3. genrule2: Zip the js file.\n\nWhat about just checking in 1 javascript file for your plugin instead of 3? The plugin is small enough, so this is still readable. Minifying and zipping also seems unnecessary boilerplate. So if you just have one js file, then you can reference that from your gerrit_plugin() resources directly and do not have to use any of the above 3 BUILD rules. WDYT?",
      "parentUuid": "b35467b0_5328feae",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a964480_8590d726",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2021-04-23T08:51:52Z",
      "side": 1,
      "message": "Nasser, I agree with Ben - \"standalone\" build is a substantial amount of work. I described required steps below, but first let me answer to some of your comments.\n\n\u003e\u003e having the Gerrit source tree shouldn\u0027t be required.\n\nAs far as I know, all existing plugins require Gerrit source tree. The WORKSPACE file is located in the Gerrit source tree and none of the plugin has its own WORKSPACE file. According to the Bazel docs the WORKSPACE is required - it defines the root of a workspace (https://docs.bazel.build/versions/master/build-ref.html).\nSo, it is impossible to build plugin without cloning the Gerrit tree (a developer can clone either the latest version or a stable branch).\n\nThis plugin (\"task\") already loads items from \"//tools/bzl:plugin.bzl\", so it is already depends on the Gerrit tree.\n\nOther plugins also depends on the Gerrit tree (for example https://gerrit.googlesource.com/plugins/rename-project/+/refs/heads/master/BUILD:\n  # //tools/bzl:junit.bzl is in the Gerrit tree\n  load(\"//tools/bzl:junit.bzl\", \"junit_tests\")\n  # //tools/bzl:plugin.bzl is in the Gerrit tree\n  load(\n      \"//tools/bzl:plugin.bzl\",\n      \"PLUGIN_DEPS\",\n      \"PLUGIN_TEST_DEPS\",\n      \"gerrit_plugin\",\n  )\n)\n\n\u003e\u003e The face value benefit is that I only need to clone the plugin I want to develop on to be able to develop it... That benefit multiplies into others like a simpler CI/CD setup too.\n\nI think we all agree with these benefits, but right now it doesn\u0027t look like an easy task to do and a good reusable solution requires weeks of work.\n\nI did some research some time ago about standalone plugins and found that:\n1) First of all, a plugin must have its own workspace with WORKSPACE file.\n2a) The plugin should either has its own package.json with all dependencies (including rollup.js) \nOR\n2b) we should create our own rules for gerrit plugins and publish them separately (similar to rules_nodejs), so Gerrit plugins can use it.\n\nI think, the 2b is the best solution, but as I wrote above - it requires weeks of work and should be planned.\n\n2a is doable for this (\"task\") plugin, but the maintaining cost can be very high - in overall, packages versions must be always in sync between a plugin and the Gerrit. Maybe for this is not a problem right now, but the solution can\u0027t be scaled to other plugins. And I think it is not good to have a special solution for a single plugin.",
      "parentUuid": "4d0af775_81467798",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab2e911e_4f8f0cdf",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1085901
      },
      "writtenOn": "2021-04-23T09:07:50Z",
      "side": 1,
      "message": "Sorry, I didn\u0027t notice that actually \"task\" plugin already has its own WORKSPACE and there is a bazlets :(\nI need some time to think about it.",
      "parentUuid": "8a964480_8590d726",
      "revId": "a2b80af6688153db4c4f58081f2201e171a9daba",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}